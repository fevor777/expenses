import{Ba as oe,Ca as ae,D as n,Da as k,E as S,Ea as N,F as _,Fa as R,G as p,Ga as F,H as d,Ia as se,J as s,Ja as le,K as l,Ka as T,L as y,La as ce,M as A,Ma as ue,N as Y,O as x,P as f,Q as u,S as c,T as v,U as b,V as U,W as w,X as E,Y as M,Z as z,_ as I,a as L,aa as H,ea as J,fa as K,ga as Q,i as j,j as X,ja as Z,k as C,ka as $,l as G,n as D,q,r as P,ta as ee,v as m,va as te,w as g,wa as ie,xa as re,ya as ne}from"./chunk-EFH5KHDJ.js";import{a as O,b as W}from"./chunk-MZBEQE75.js";var me=o=>({"history-expand-filter-button-active":o});function ge(o,t){if(o&1){let e=x();s(0,"span")(1,"span"),c(2,"\u0424\u0438\u043B\u044C\u0442\u0440\u044B:"),l(),s(3,"i",10),f("click",function(){m(e);let r=u();return g(r.clearFilters())}),l(),y(4,"br"),c(5," \u041F\u0435\u0440\u0438\u043E\u0434: "),s(6,"span"),c(7),l(),y(8,"br"),c(9," \u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438: "),s(10,"span"),c(11),l()()}if(o&2){let e=u();n(),d("font-weight","bold"),n(2),d("padding-left","10px"),n(3),d("color","#ff6f61"),n(),v((e.currentFilter==null?null:e.currentFilter.display)||"\u0412\u0435\u0441\u044C"),n(3),d("color","#ff6f61"),n(),v(e.getCategoryFilters()||"\u0412\u0441\u0435")}}function fe(o,t){if(o&1&&(s(0,"span")(1,"div")(2,"span"),c(3,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),l(),s(4,"span"),c(5),l()()()),o&2){let e=u();n(),d("margin","10","px"),n(3),d("color","#ff6f61"),n(),b("",e.totalAmount,"\u20AC")}}function ye(o,t){if(o&1&&(s(0,"div")(1,"span"),c(2,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),l(),s(3,"span"),c(4),l()()),o&2){let e=u();d("margin","10","px"),n(3),d("color","#ff6f61"),n(),b("",e.totalAmount,"\u20AC")}}function he(o,t){if(o&1){let e=x();A(0),s(1,"div",25)(2,"input",26),f("change",function(){m(e);let r=u(2);return g(r.applyCategoryFilters())}),M("ngModelChange",function(r){let a=m(e).$implicit,h=u(2);return E(h.filterCategories[a.id],r)||(h.filterCategories[a.id]=r),g(r)}),l(),s(3,"label",27),c(4),l()(),Y()}if(o&2){let e=t.$implicit,i=u(2);n(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),w("ngModel",i.filterCategories[e.id]),n(),p("for",e.id),n(),v(e.name)}}function _e(o,t){if(o&1){let e=x();A(0),s(1,"div",25)(2,"input",26),f("change",function(){m(e);let r=u(2);return g(r.applyCategoryFilters())}),M("ngModelChange",function(r){let a=m(e).$implicit,h=u(2);return E(h.filterCategories[a.id],r)||(h.filterCategories[a.id]=r),g(r)}),l(),s(3,"label",27),c(4),l()(),Y()}if(o&2){let e=t.$implicit,i=u(2);n(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),w("ngModel",i.filterCategories[e.id]),n(),p("for",e.id),n(),v(e.name)}}function xe(o,t){if(o&1){let e=x();s(0,"div",11)(1,"div",12)(2,"div",13)(3,"app-date-filter",14),f("changeFilter",function(r){m(e);let a=u();return g(a.applyFilters(r))}),l()(),s(4,"div",15)(5,"span"),c(6,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:"),l(),y(7,"br"),s(8,"button",16),f("click",function(){m(e);let r=u();return g(r.clearCategoryFilters())}),c(9,"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u0438\u043B\u044C\u0442\u0440\u044B"),l(),y(10,"br"),s(11,"div",17)(12,"input",18),f("change",function(){m(e);let r=u();return g(r.filterMass("regular"))}),M("ngModelChange",function(r){m(e);let a=u();return E(a.filterCategories.regular,r)||(a.filterCategories.regular=r),g(r)}),l(),s(13,"label",19),c(14,"\u0420\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(15,"div",20),_(16,he,5,6,"ng-container",9),l(),s(17,"div",17)(18,"input",21),f("change",function(){m(e);let r=u();return g(r.filterMass("irregular"))}),M("ngModelChange",function(r){m(e);let a=u();return E(a.filterCategories.irregular,r)||(a.filterCategories.irregular=r),g(r)}),l(),s(19,"label",22),c(20,"\u041D\u0435\u0440\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(21,"div",20),_(22,_e,5,6,"ng-container",9),l()()(),s(23,"div",23)(24,"button",24),f("click",function(){m(e);let r=u();return g(r.applyFiltersAndClose())}),c(25,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"),l()()()}if(o&2){let e=u();n(3),p("value",e.currentFilter),n(9),p("checked",e.filterCategories.regular),w("ngModel",e.filterCategories.regular),n(4),p("ngForOf",e.categories.regular),n(2),p("checked",e.filterCategories.irregular),w("ngModel",e.filterCategories.irregular),n(4),p("ngForOf",e.categories.irregular)}}function Ce(o,t){o&1&&(s(0,"div",28)(1,"span"),c(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),l()())}function ve(o,t){if(o&1&&(s(0,"span")(1,"span"),c(2),I(3,"date"),l(),s(4,"span"),c(5),l()()),o&2){let e=u().$implicit,i=u();d("background","#f8d7da")("width","100%")("display","block"),n(2),b("",H(3,10,e.date,"dd-MM-YYYY")," - "),n(2),d("font-weight","600"),n(),b("",i.getTotalAmountPerDay(e.date),"\u20AC")}}function be(o,t){if(o&1){let e=x();s(0,"span",24),f("click",function(){m(e);let r=u().index,a=u();return g(a.onDeleteFromBalance(r))}),c(1," | Delete from balance"),l()}o&2&&d("color","grey")("cursor","pointer")}function Fe(o,t){if(o&1){let e=x();s(0,"span"),_(1,ve,6,13,"span",29),s(2,"div",30),y(3,"br"),c(4,"\u0426\u0435\u043D\u0430: "),s(5,"span"),c(6),l(),y(7,"br")(8,"br"),s(9,"div"),c(10," Category: "),s(11,"span",31),f("click",function(){let r=m(e).$implicit,a=u();return g(a.showCategoryDetails(r.category))}),c(12),l()(),c(13),I(14,"date"),I(15,"date"),y(16,"br")(17,"br"),s(18,"span",24),f("click",function(){let r=m(e).index,a=u();return g(a.onDelete(r))}),c(19,"Delete"),l(),_(20,be,2,4,"span",32),l(),y(21,"hr"),l()}if(o&2){let e=t.$implicit,i=u();n(),p("ngIf",e.showDateTitle),n(4),d("color","#ff6f61"),n(),b("",e.amount,"\u20AC"),n(6),v(i.getCategoryNameByIdFunc(e.category)),n(),U(" Date: ",H(14,16,e.date,"HH:mm")," (",H(15,19,e.date,"dd-MM-YYYY"),")"),n(5),d("color","grey")("cursor","pointer"),n(2),p("ngIf",!e.isDeletedFromBalance&&i.getCategoryByIdFunc(e.category).includeInBalance),n(),d("background","#f8d7da")("height","2px")}}var V=class o{constructor(t,e,i,r){this.router=t;this.expenseService=e;this.balanceService=i;this.dateFilterService=r}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=R;categories={regular:F.filter(t=>!t.includeInBalance),irregular:F.filter(t=>t.includeInBalance)};filterCategories=F.reduce((t,e)=>(t[e.id]=!1,t),{});currentPeriod="\u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F";currentFilter;expandFilters=!1;getCategoryNameByIdFunc=N;destroySubject=new L;ngOnInit(){this.dateFilterService.dateFilter&&(this.currentFilter=O({},this.dateFilterService.dateFilter),this.dateFilterService.dateFilter=void 0);let t=this.dateFilterService.categories;Array.isArray(t)&&t.length>0&&(this.filterCategories=F.reduce((e,i)=>(e[i.id]=t.includes(i.id),e),{}),this.dateFilterService.categories=void 0),this.currentFilter||t?.length>0?this.applyFilters(this.currentFilter):this.initiateExpenses().pipe(j(),C(this.destroySubject)).subscribe(()=>{this.sumValues(),this.filterCategories.irregular=!1,this.filterCategories.regular=!1})}initiateExpenses(){return this.expenseService.getExpenses().pipe(G(t=>{this.expenses=t.map(e=>{let i=this.isDatePanelVisible(e.date);if(i)this.totalAmountPerDays.set(e.date,e.amount);else{let r=this.totalAmountPerDays.get(this.temporaryDate)||0,a=Math.round((r+e.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,a)}return W(O({},e),{showDateTitle:i})})}))}getCategoryFilters(){let t=Object.keys(this.filterCategories).filter(e=>this.filterCategories[e]).map(e=>N(e));return F.length===t.length?"":t.join(", ")}applyFilters(t){this.initiateExpenses().pipe(j(),C(this.destroySubject)).subscribe(()=>{this.checkMainCategory(),this.expenses=this.expenses.filter(e=>Object.values(this.filterCategories).every(i=>!i)||Object.keys(this.filterCategories).some(i=>this.filterCategories[i]&&e.category===i)),this.currentFilter=t,t&&(this.currentPeriod=t.display,this.expenses=ce(this.expenses,t.start,t.finish)),this.sumValues()})}applyFiltersAndClose(){this.applyFilters(this.currentFilter),this.expandFilters=!1}checkMainCategory(){let t=this.categories.regular.map(a=>a.id),e=this.categories.irregular.map(a=>a.id),i=t.every(a=>this.filterCategories[a]),r=e.every(a=>this.filterCategories[a]);return this.filterCategories.regular=i,this.filterCategories.irregular=r,{regularChecked:i,irregularChecked:r}}filterMass(t){let e=t==="regular"?this.categories.regular:this.categories.irregular;e=e.map(i=>i.id),this.filterCategories[t]&&e.forEach(i=>{this.filterCategories[i]=!1});for(let i in this.filterCategories)e.includes(i)&&(this.filterCategories[i]=!this.filterCategories[i]);this.applyFilters(this.currentFilter)}initiateFilterCategory(){for(let t in this.filterCategories)this.filterCategories[t]=!1}applyCategoryFilters(){this.applyFilters(this.currentFilter)}clearFilters(){this.currentFilter=void 0,this.clearCategoryFilters()}clearCategoryFilters(){this.initiateFilterCategory(),this.applyFilters(this.currentFilter)}toggleExpandFilters(){this.expandFilters=!this.expandFilters}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){if(confirm("Delete?")){this.updateBalance(t);let e=this.expenses[t].id;this.expenseService.deleteExpense(e).pipe(X(()=>this.initiateExpenses()),C(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(t,e){let i=Number(localStorage.getItem("balance"))||0,r=R(this.expenses[t].category);if(i&&!this.expenses[t]?.isDeletedFromBalance&&r?.includeInBalance){let a=Math.round((i+this.expenses[t].amount)*100)/100;this.balanceService.addBalance(a).pipe(C(this.destroySubject)).subscribe()}e&&(this.expenses[t].isDeletedFromBalance=e,this.expenseService.updateExpense(this.expenses[t]).pipe(C(this.destroySubject)).subscribe())}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t,!0)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let i=t+e.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(e){return new(e||o)(S(oe),S(se),S(le),S(ue))};static \u0275cmp=q({type:o,selectors:[["app-history"]],hostBindings:function(e,i){e&1&&f("touchstart",function(a){return i.onTouchStart(a)})("touchend",function(a){return i.onTouchEnd(a)})},decls:14,vars:18,consts:[[1,"history-container"],[3,"routerLink"],[1,"history-container-top"],[4,"ngIf"],[1,"history-expand-filter-button",3,"click","ngClass"],[1,"fas","fa-filter"],[3,"margin",4,"ngIf"],["class","history-expand-filter-container",4,"ngIf"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fas","fa-redo-alt",3,"click"],[1,"history-expand-filter-container"],[1,"history-expand-filter"],[1,"history-expand-filter-date"],[3,"changeFilter","value"],[1,"history-expand-filter-category"],[1,"history-button-clear-filters",3,"click"],[1,"category-checkbox","category-checkbox-main"],["type","checkbox","value","regular","id","category-regular",3,"change","ngModelChange","checked","ngModel"],["for","category-regular"],[1,"sub-category-items"],["type","checkbox","value","irregular","id","category-irregular",3,"change","ngModelChange","checked","ngModel"],["for","category-irregular"],[1,"history-expand-filter-buttons"],[3,"click"],[1,"category-checkbox","category-checkbox-sub"],["type","checkbox",3,"change","ngModelChange","value","id","checked","ngModel"],[3,"for"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(e,i){if(e&1&&(s(0,"div",0)(1,"span",1),c(2,"< Back"),l(),y(3,"br"),s(4,"div",2),_(5,ge,12,10,"span",3)(6,fe,6,5,"span",3),s(7,"button",4),f("click",function(){return i.toggleExpandFilters()}),y(8,"i",5),l()(),_(9,ye,5,5,"div",6)(10,xe,26,7,"div",7),y(11,"hr"),_(12,Ce,3,0,"div",8)(13,Fe,22,22,"span",9),l()),e&2){let r,a,h;n(),d("color","blue")("cursor","pointer"),p("routerLink","/"),n(4),p("ngIf",(i.currentFilter==null?null:i.currentFilter.display)||((r=i.getCategoryFilters())==null?null:r.length)),n(),p("ngIf",!(i.currentFilter!=null&&i.currentFilter.display)&&!((a=i.getCategoryFilters())!=null&&a.length)),n(),p("ngClass",z(16,me,i.expandFilters)),n(2),p("ngIf",(i.currentFilter==null?null:i.currentFilter.display)||((h=i.getCategoryFilters())==null?null:h.length)),n(),p("ngIf",i.expandFilters),n(),d("background","#f8d7da")("height","2px"),n(),p("ngIf",!i.expenses.length),n(),p("ngForOf",i.expenses)}},dependencies:[ae,J,K,Q,ee,te,ie,T,Z],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-expand-filter-button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:transparent;border-radius:5px;padding:.5rem 1rem;margin:.5rem;cursor:pointer}.history-expand-filter-button-active[_ngcontent-%COMP%]{background-color:#f8d7da}.history-expand-filter-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column;margin:.5rem}.history-button-clear-filters[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:gray;border:none;background-color:transparent;cursor:pointer;margin:.5rem 0 0;padding:0;text-decoration:underline}.history-expand-filter-buttons[_ngcontent-%COMP%]{display:flex;margin:1rem 0;width:100%;justify-content:center}.history-expand-filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:#f8d7da;border-radius:5px;padding:.5rem 1rem;cursor:pointer;width:100%}.history-expand-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%}.history-expand-filter[_ngcontent-%COMP%]   .history-expand-filter-date[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;font-family:Montserrat,sans-serif;padding:.5rem;border:2px solid #f8d7da;border-radius:5px;cursor:pointer}.category-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:.5rem;margin-top:.5rem}.category-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}.category-checkbox-main[_ngcontent-%COMP%]{display:flex;font-family:Montserrat,sans-serif;color:#000;flex-direction:row;gap:.5rem}.category-checkbox-sub[_ngcontent-%COMP%]{margin-left:2rem}.history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}"]})};var Se=[{path:"",component:V}],B=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=P({type:o});static \u0275inj=D({imports:[k.forChild(Se),k]})};var de=class o{static \u0275fac=function(e){return new(e||o)};static \u0275mod=P({type:o});static \u0275inj=D({imports:[k,B,$,re,ne,T]})};export{de as HistoryModule};
