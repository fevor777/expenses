import{$ as w,F as r,G as b,Ga as q,H as x,Ha as z,I as u,J as m,Ka as U,L as a,La as J,M as s,Ma as F,N as f,Na as V,O as T,Oa as O,P as d,Q as p,Qa as S,S as l,Sa as K,T as k,Ta as Q,U as M,Ua as W,V as R,Va as P,a as j,ba as I,ga as X,ha as L,j as C,ka as $,l as A,la as G,m as y,n as Y,p as D,s as N,t as E,x as _,y as v}from"./chunk-T7NWDN6L.js";import"./chunk-S2K6666W.js";import{a as h,b as g}from"./chunk-WT4EHPVH.js";function te(n,e){n&1&&(a(0,"div",5)(1,"span"),l(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),s()())}function ie(n,e){if(n&1&&(a(0,"span")(1,"span"),l(2),w(3,"date"),s(),a(4,"span"),l(5),s()()),n&2){let t=p().$implicit,i=p();m("background","#f8d7da")("width","100%")("display","block"),r(2),M("",I(3,10,t.date,"dd-MM-YYYY")," - "),r(2),m("font-weight","600"),r(),M("",i.getTotalAmountPerDay(t.date),"\u20AC")}}function ne(n,e){n&1&&(a(0,"span"),l(1,'"'),s())}function re(n,e){n&1&&(a(0,"span"),l(1,'"'),s())}function oe(n,e){if(n&1){let t=T();a(0,"span",13),d("click",function(){_(t);let c=p().index,o=p();return v(o.onDeleteFromBalance(c))}),l(1," | Delete from balance"),s()}n&2&&m("color","grey")("cursor","pointer")}function ae(n,e){if(n&1){let t=T();a(0,"span"),x(1,ie,6,13,"span",6),a(2,"div",7),f(3,"br"),l(4,"\u0426\u0435\u043D\u0430: "),a(5,"span"),l(6),s(),f(7,"br")(8,"br"),a(9,"div"),l(10," Category: "),a(11,"span",8),d("click",function(){let c=_(t).$implicit,o=p();return v(o.filterByCategory(c.category))}),l(12),s(),a(13,"i",9),d("click",function(){let c=_(t).$implicit,o=p();return v(o.navigateToChart(c.category))}),s()(),l(14),w(15,"date"),w(16,"date"),a(17,"div")(18,"span",10),l(19,"Description:"),s(),x(20,ne,2,0,"span",11),a(21,"span"),l(22),s(),x(23,re,2,0,"span",11),a(24,"i",12),d("click",function(){let c=_(t).$implicit,o=p();return v(o.changeDescription(c))}),s()(),f(25,"br")(26,"br"),a(27,"span",13),d("click",function(){let c=_(t).index,o=p();return v(o.onDelete(c))}),l(28,"Delete"),s(),x(29,oe,2,4,"span",14),s(),f(30,"hr"),s()}if(n&2){let t=e.$implicit,i=p();r(),u("ngIf",t.showDateTitle),r(4),m("color","#ff6f61"),r(),M("",t.amount,"\u20AC"),r(6),k(i.getCategoryNameByIdFunc(t.category)),r(2),R(" Date: ",I(15,19,t.date,"HH:mm")," (",I(16,22,t.date,"dd-MM-YYYY"),") "),r(6),u("ngIf",t.description),r(2),k(t.description),r(),u("ngIf",t.description),r(4),m("color","grey")("cursor","pointer"),r(2),u("ngIf",!t.isDeletedFromBalance&&i.getCategoryByIdFunc(t.category).includeInBalance),r(),m("background","#f8d7da")("height","2px")}}var B=class n{constructor(e,t,i,c){this.router=e;this.expenseService=t;this.balanceService=i;this.dateFilterService=c}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=O;defaultDateValue=S.initialMonthValue;defaultFilter={categories:[],date:S.initialMonthValue};currentFilter={categories:[],date:S.initialMonthValue};getCategoryNameByIdFunc=V;destroySubject=new j;ngOnInit(){this.dateFilterService.dateFilter&&(this.defaultFilter=g(h({},this.defaultFilter),{date:this.dateFilterService.dateFilter}),this.dateFilterService.dateFilter=void 0);let e=this.dateFilterService.categories;Array.isArray(e)&&e.length>0&&(this.defaultFilter=g(h({},this.defaultFilter),{categories:e}),this.dateFilterService.categories=void 0),this.defaultFilter?.date||this.defaultFilter?.categories?.length>0?this.applyFilters(this.defaultFilter):this.initiateExpenses().pipe(C(),y(this.destroySubject)).subscribe(()=>{this.sumValues()})}initiateExpenses(){return this.expenseService.getExpenses(this.currentFilter?.date,this.currentFilter?.categories).pipe(Y(e=>{this.expenses=e.map(t=>{let i=this.isDatePanelVisible(t.date);if(i)this.totalAmountPerDays.set(t.date,t.amount);else{let c=this.totalAmountPerDays.get(this.temporaryDate)||0,o=Math.round((c+t.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,o)}return g(h({},t),{showDateTitle:i})})}))}changeDescription(e){let t=prompt("Change description",e?.description);if(t!==null){let i=e.description?e.description:"";t=t?t?.trim():"",i!==t&&this.expenseService.updateExpense(g(h({},e),{description:t})).pipe(C(),y(this.destroySubject)).subscribe(()=>{this.applyFilters(this.currentFilter)})}}navigateToChart(e){this.dateFilterService.categories=[e],this.dateFilterService.dateFilter=this.currentFilter?.date,this.router.navigate(["/details"],{queryParams:{"back-url":"/history"}})}getCategoryFilters(){return this.defaultFilter?.categories.map(V).join(", ")}applyFilters(e){this.currentFilter=h({},e||{categories:[],date:S.initialMonthValue}),this.initiateExpenses().pipe(C(),y(this.destroySubject)).subscribe(()=>{this.sumValues()})}filterByCategory(e){this.defaultFilter=g(h({},this.currentFilter),{categories:[e]}),this.applyFilters(this.defaultFilter);let t=document.getElementById("back");t!==null&&(t.scrollIntoView(),t=null)}getTotalAmountPerDay(e){return this.totalAmountPerDays.get(e)||0}onDelete(e){if(confirm("Delete?")){this.updateBalance(e);let t=this.expenses[e].id;this.expenseService.deleteExpense(t).pipe(A(()=>this.initiateExpenses()),y(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(e,t){let i=Number(localStorage.getItem("balance"))||0,c=O(this.expenses[e].category);if(i&&!this.expenses[e]?.isDeletedFromBalance&&c?.includeInBalance){let o=Math.round((i+this.expenses[e].amount)*100)/100;this.balanceService.addBalance(o).pipe(y(this.destroySubject)).subscribe()}t&&(this.expenses[e].isDeletedFromBalance=t,this.expenseService.updateExpense(this.expenses[e]).pipe(y(this.destroySubject)).subscribe())}onDeleteFromBalance(e){confirm("Return to balance?")&&this.updateBalance(e,!0)}onSwipeRight(){this.router.navigate(["/"])}isDatePanelVisible(e){return this.temporaryDate===0?(this.temporaryDate=e,!0):new Date(this.temporaryDate).toDateString()===new Date(e).toDateString()?!1:(this.temporaryDate=e,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&(e>100?this.onSwipeRight():e<-100&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((e,t)=>{let i=e+t.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(t){return new(t||n)(b(U),b(K),b(Q),b(W))};static \u0275cmp=N({type:n,selectors:[["app-history"]],hostBindings:function(t,i){t&1&&d("touchstart",function(o){return i.onTouchStart(o)})("touchend",function(o){return i.onTouchEnd(o)})},decls:8,vars:14,consts:[[1,"history-container"],["id","back",3,"routerLink"],[3,"selectedFilters","value","totalAmount","defaultDateValue"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[1,"fas","fa-chart-bar","history-item-chart",3,"click"],[1,"history-item-description-label"],[4,"ngIf"],[1,"history-item-description-edit-icon","fas","fa-pencil-alt",3,"click"],[3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"span",1),l(2,"< Back"),s(),f(3,"br"),a(4,"app-multi-filter",2),d("selectedFilters",function(o){return i.applyFilters(o)}),s(),f(5,"hr"),x(6,te,3,0,"div",3)(7,ae,31,25,"span",4),s()),t&2&&(r(),m("color","blue")("cursor","pointer"),u("routerLink","/"),r(3),u("value",i.defaultFilter)("totalAmount",i.totalAmount)("defaultDateValue",i.defaultDateValue),r(),m("background","#f8d7da")("height","2px"),r(),u("ngIf",!i.expenses.length),r(),u("ngForOf",i.expenses))},dependencies:[J,X,L,P,$],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container[_ngcontent-%COMP%]   .history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-container[_ngcontent-%COMP%]   .history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}.history-container[_ngcontent-%COMP%]   .history-item-chart[_ngcontent-%COMP%]{padding:15px 15px 0 25px;font-size:15px;color:gray}.history-container[_ngcontent-%COMP%]   .history-item-description-label[_ngcontent-%COMP%]{margin-right:5px}.history-container[_ngcontent-%COMP%]   .history-item-description-edit-icon[_ngcontent-%COMP%]{padding:5px;color:gray;cursor:pointer}"]})};var se=[{path:"",component:B}],H=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=E({type:n});static \u0275inj=D({imports:[F.forChild(se),F]})};var ee=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=E({type:n});static \u0275inj=D({imports:[F,H,G,q,z,P]})};export{ee as HistoryModule};
