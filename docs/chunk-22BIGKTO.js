import{$ as A,Aa as re,Ba as M,Ca as ne,D as o,Da as N,E as v,Ea as P,F as y,G as p,Ga as oe,H as f,Ha as ae,Ia as se,J as s,Ja as I,K as l,Ka as H,L as h,La as le,M as B,N as O,O as C,P as g,Q as c,S as u,T as k,U as _,V as S,W as w,X as E,Y as q,Z as j,a as R,da as U,ea as z,fa as J,ia as K,j as W,ja as Q,k as x,l as X,n as F,pa as Z,q as G,r as D,ra as $,sa as ee,ta as te,v as d,w as m,za as ie}from"./chunk-ZB27WVGF.js";import{a as Y,b as L}from"./chunk-MZBEQE75.js";var pe=a=>({"history-expand-filter-button-active":a});function de(a,t){if(a&1){let e=C();B(0),s(1,"div",22)(2,"input",23),g("change",function(){d(e);let r=c(2);return m(r.applyFilters())}),E("ngModelChange",function(r){let n=d(e).$implicit,b=c(2);return w(b.filterCategories[n.id],r)||(b.filterCategories[n.id]=r),m(r)}),l(),s(3,"label",24),u(4),l()(),O()}if(a&2){let e=t.$implicit,i=c(2);o(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),S("ngModel",i.filterCategories[e.id]),o(),p("for",e.id),o(),k(e.name)}}function me(a,t){if(a&1){let e=C();B(0),s(1,"div",22)(2,"input",23),g("change",function(){d(e);let r=c(2);return m(r.applyFilters())}),E("ngModelChange",function(r){let n=d(e).$implicit,b=c(2);return w(b.filterCategories[n.id],r)||(b.filterCategories[n.id]=r),m(r)}),l(),s(3,"label",24),u(4),l()(),O()}if(a&2){let e=t.$implicit,i=c(2);o(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),S("ngModel",i.filterCategories[e.id]),o(),p("for",e.id),o(),k(e.name)}}function ge(a,t){if(a&1){let e=C();s(0,"div",8)(1,"div",9)(2,"div",10)(3,"span"),u(4),l(),s(5,"app-date-filter",11),g("changeDayEvent",function(){d(e);let r=c();return m(r.applyFilters())}),l()(),s(6,"div",12)(7,"span"),u(8,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:"),l(),h(9,"br"),s(10,"button",13),g("click",function(){d(e);let r=c();return m(r.clearFilters())}),u(11,"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u0438\u043B\u044C\u0442\u0440\u044B"),l(),h(12,"br"),s(13,"div",14)(14,"input",15),g("change",function(){d(e);let r=c();return m(r.filterMass("regular"))}),E("ngModelChange",function(r){d(e);let n=c();return w(n.filterCategories.regular,r)||(n.filterCategories.regular=r),m(r)}),l(),s(15,"label",16),u(16,"\u0420\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(17,"div",17),y(18,de,5,6,"ng-container",7),l(),s(19,"div",14)(20,"input",18),g("change",function(){d(e);let r=c();return m(r.filterMass("irregular"))}),E("ngModelChange",function(r){d(e);let n=c();return w(n.filterCategories.irregular,r)||(n.filterCategories.irregular=r),m(r)}),l(),s(21,"label",19),u(22,"\u041D\u0435\u0440\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(23,"div",17),y(24,me,5,6,"ng-container",7),l()()(),s(25,"div",20)(26,"button",21),g("click",function(){d(e);let r=c();return m(r.applyFiltersAndClose())}),u(27,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"),l()()()}if(a&2){let e=c();o(4),_("\u041F\u0435\u0440\u0438\u043E\u0434: ",e.currentPeriod,""),o(10),p("checked",e.filterCategories.regular),S("ngModel",e.filterCategories.regular),o(4),p("ngForOf",e.categories.regular),o(2),p("checked",e.filterCategories.irregular),S("ngModel",e.filterCategories.irregular),o(4),p("ngForOf",e.categories.irregular)}}function fe(a,t){a&1&&(s(0,"div",25)(1,"span"),u(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),l()())}function he(a,t){if(a&1&&(s(0,"span")(1,"span"),u(2),j(3,"date"),l(),s(4,"span"),u(5),l()()),a&2){let e=c().$implicit,i=c();f("background","#f8d7da")("width","100%")("display","block"),o(2),_("",A(3,10,e.date,"dd-MM-YYYY")," - "),o(2),f("font-weight","600"),o(),_("",i.getTotalAmountPerDay(e.date),"\u20AC")}}function ye(a,t){if(a&1){let e=C();s(0,"span",21),g("click",function(){d(e);let r=c().index,n=c();return m(n.onDeleteFromBalance(r))}),u(1," | Delete from balance"),l()}a&2&&f("color","grey")("cursor","pointer")}function _e(a,t){if(a&1){let e=C();s(0,"span"),y(1,he,6,13,"span",26),s(2,"div",27),h(3,"br"),u(4,"\u0426\u0435\u043D\u0430: "),s(5,"span"),u(6),l(),h(7,"br")(8,"br"),s(9,"div"),u(10," Category: "),s(11,"span",28),g("click",function(){let r=d(e).$implicit,n=c();return m(n.showCategoryDetails(r.category))}),u(12),l()(),u(13),j(14,"date"),h(15,"br")(16,"br"),s(17,"span",21),g("click",function(){let r=d(e).index,n=c();return m(n.onDelete(r))}),u(18,"Delete"),l(),y(19,ye,2,4,"span",29),l(),h(20,"hr"),l()}if(a&2){let e=t.$implicit,i=c();o(),p("ngIf",e.showDateTitle),o(4),f("color","#ff6f61"),o(),_("",e.amount,"\u20AC"),o(6),k(i.getCategoryNameByIdFunc(e.category)),o(),_(" Date: ",A(14,15,e.date,"HH:mm")," "),o(4),f("color","grey")("cursor","pointer"),o(2),p("ngIf",!e.isDeletedFromBalance&&i.getCategoryByIdFunc(e.category).includeInBalance),o(),f("background","#f8d7da")("height","2px")}}var V=class a{constructor(t,e,i,r){this.router=t;this.expenseService=e;this.balanceService=i;this.dateFilterService=r}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=N;categories={regular:P.filter(t=>!t.includeInBalance),irregular:P.filter(t=>t.includeInBalance)};filterCategories=P.reduce((t,e)=>(t[e.id]=!1,t),{});currentPeriod="\u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F";expandFilters=!1;getCategoryNameByIdFunc=ne;destroySubject=new R;ngOnInit(){this.initiateExpenses().pipe(x(this.destroySubject)).subscribe(()=>{this.sumValues(),this.filterCategories.irregular=!1,this.filterCategories.regular=!1}),this.currentPeriod=this.dateFilterService.getCurrentDateFrame().display}initiateExpenses(){return this.expenseService.getExpenses().pipe(X(t=>{this.expenses=t.map(e=>{let i=this.isDatePanelVisible(e.date);if(i)this.totalAmountPerDays.set(e.date,e.amount);else{let r=this.totalAmountPerDays.get(this.temporaryDate)||0,n=Math.round((r+e.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,n)}return L(Y({},e),{showDateTitle:i})})}))}applyFilters(){this.initiateExpenses().pipe(x(this.destroySubject)).subscribe(()=>{this.checkMainCategory(),this.expenses=this.expenses.filter(e=>Object.values(this.filterCategories).every(i=>!i)||Object.keys(this.filterCategories).some(i=>this.filterCategories[i]&&e.category===i));let t=this.dateFilterService.getCurrentDateFrame();this.currentPeriod=t.display,this.expenses=se(this.expenses,t.start,t.finish),this.sumValues()})}applyFiltersAndClose(){this.applyFilters(),this.expandFilters=!1}checkMainCategory(){let t=this.categories.regular.map(n=>n.id),e=this.categories.irregular.map(n=>n.id),i=t.every(n=>this.filterCategories[n]),r=e.every(n=>this.filterCategories[n]);return this.filterCategories.regular=i,this.filterCategories.irregular=r,{regularChecked:i,irregularChecked:r}}filterMass(t){let e=t==="regular"?this.categories.regular:this.categories.irregular;e=e.map(i=>i.id),this.filterCategories[t]&&e.forEach(i=>{this.filterCategories[i]=!1});for(let i in this.filterCategories)e.includes(i)&&(this.filterCategories[i]=!this.filterCategories[i]);this.applyFilters()}initiateFilterCategory(){for(let t in this.filterCategories)this.filterCategories[t]=!1}clearFilters(){this.initiateFilterCategory(),this.dateFilterService.refreshDateFrame(),this.applyFilters()}toggleExpandFilters(){this.applyFilters(),this.expandFilters=!this.expandFilters}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){if(confirm("Delete?")){this.updateBalance(t);let e=this.expenses[t].id;this.expenseService.deleteExpense(e).pipe(W(()=>this.initiateExpenses()),x(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(t,e){let i=Number(localStorage.getItem("balance"))||0,r=N(this.expenses[t].category);if(i&&!this.expenses[t]?.isDeletedFromBalance&&r?.includeInBalance){let n=Math.round((i+this.expenses[t].amount)*100)/100;this.balanceService.addBalance(n).pipe(x(this.destroySubject)).subscribe()}e&&(this.expenses[t].isDeletedFromBalance=e,this.expenseService.updateExpense(this.expenses[t]).pipe(x(this.destroySubject)).subscribe())}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t,!0)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let i=t+e.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(e){return new(e||a)(v(ie),v(oe),v(ae),v(H))};static \u0275cmp=G({type:a,selectors:[["app-history"]],hostBindings:function(e,i){e&1&&g("touchstart",function(n){return i.onTouchStart(n)})("touchend",function(n){return i.onTouchEnd(n)})},decls:16,vars:20,consts:[[1,"history-container"],[3,"routerLink"],[1,"history-container-top"],[1,"history-expand-filter-button",3,"click","ngClass"],[1,"fas","fa-filter"],["class","history-expand-filter-container",4,"ngIf"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"history-expand-filter-container"],[1,"history-expand-filter"],[1,"history-expand-filter-date"],[3,"changeDayEvent"],[1,"history-expand-filter-category"],[1,"history-button-clear-filters",3,"click"],[1,"category-checkbox","category-checkbox-main"],["type","checkbox","value","regular","id","category-regular",3,"change","ngModelChange","checked","ngModel"],["for","category-regular"],[1,"sub-category-items"],["type","checkbox","value","irregular","id","category-irregular",3,"change","ngModelChange","checked","ngModel"],["for","category-irregular"],[1,"history-expand-filter-buttons"],[3,"click"],[1,"category-checkbox","category-checkbox-sub"],["type","checkbox",3,"change","ngModelChange","value","id","checked","ngModel"],[3,"for"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"span",1),u(2,"< Back"),l(),h(3,"br"),s(4,"div",2)(5,"div")(6,"span"),u(7,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),l(),s(8,"span"),u(9),l()(),s(10,"button",3),g("click",function(){return i.toggleExpandFilters()}),h(11,"i",4),l()(),y(12,ge,28,7,"div",5),h(13,"hr"),y(14,fe,3,0,"div",6)(15,_e,21,18,"span",7),l()),e&2&&(o(),f("color","blue")("cursor","pointer"),p("routerLink","/"),o(4),f("margin","10","px"),o(3),f("color","#ff6f61"),o(),_("",i.totalAmount,"\u20AC"),o(),p("ngClass",q(18,pe,i.expandFilters)),o(2),p("ngIf",i.expandFilters),o(),f("background","#f8d7da")("height","2px"),o(),p("ngIf",!i.expenses.length),o(),p("ngForOf",i.expenses))},dependencies:[re,U,z,J,Z,$,ee,I,K],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-expand-filter-button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:transparent;border-radius:5px;padding:.5rem 1rem;margin:.5rem;cursor:pointer}.history-expand-filter-button-active[_ngcontent-%COMP%]{background-color:#f8d7da}.history-expand-filter-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column;margin:.5rem}.history-button-clear-filters[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:gray;border:none;background-color:transparent;cursor:pointer;margin:.5rem 0 0;padding:0;text-decoration:underline}.history-expand-filter-buttons[_ngcontent-%COMP%]{display:flex;margin:1rem 0;width:100%;justify-content:center}.history-expand-filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:#f8d7da;border-radius:5px;padding:.5rem 1rem;cursor:pointer;width:100%}.history-expand-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%}.history-expand-filter[_ngcontent-%COMP%]   .history-expand-filter-date[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;font-family:Montserrat,sans-serif;padding:.5rem;border:2px solid #f8d7da;border-radius:5px;cursor:pointer}.category-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:.5rem;margin-top:.5rem}.category-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}.category-checkbox-main[_ngcontent-%COMP%]{display:flex;font-family:Montserrat,sans-serif;color:#000;flex-direction:row;gap:.5rem}.category-checkbox-sub[_ngcontent-%COMP%]{margin-left:2rem}.history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}"]})};var xe=[{path:"",component:V}],T=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=D({type:a});static \u0275inj=F({imports:[M.forChild(xe),M]})};var ue=class a{static \u0275fac=function(e){return new(e||a)};static \u0275mod=D({type:a});static \u0275inj=F({providers:[H],imports:[M,T,Q,te,le,I]})};export{ue as HistoryModule};
