import{Ba as ue,Ca as pe,D as n,Da as D,E,Ea as U,F as h,Fa as z,G as p,Ga as M,H as d,Ia as de,J as s,Ja as ge,K as l,Ka as A,L as y,La as me,M as G,Ma as fe,N as q,O as _,P as g,Q as u,S as c,T as x,U as S,V as te,W as w,X as P,Y as k,Z as ie,_ as I,a as K,aa as T,ea as re,fa as B,ga as ne,i as X,j as Q,ja as oe,k as v,ka as V,l as Z,n as b,q as O,r as F,ta as ae,u as $,v as m,va as se,w as f,wa as le,xa as H,y as ee,ya as ce}from"./chunk-EUJMMTPG.js";import{a as L,b as J}from"./chunk-MZBEQE75.js";function _e(r,t){if(r&1){let e=_();G(0),s(1,"div",9)(2,"input",10),g("change",function(){m(e);let o=u();return f(o.emitChanges())}),k("ngModelChange",function(o){let a=m(e).$implicit,C=u();return P(C.filterCategories[a.id],o)||(C.filterCategories[a.id]=o),f(o)}),l(),s(3,"label",11),c(4),l()(),q()}if(r&2){let e=t.$implicit,i=u();n(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),w("ngModel",i.filterCategories[e.id]),n(),p("for",e.id),n(),x(e.name)}}function xe(r,t){if(r&1){let e=_();G(0),s(1,"div",9)(2,"input",10),g("change",function(){m(e);let o=u();return f(o.emitChanges())}),k("ngModelChange",function(o){let a=m(e).$implicit,C=u();return P(C.filterCategories[a.id],o)||(C.filterCategories[a.id]=o),f(o)}),l(),s(3,"label",11),c(4),l()(),q()}if(r&2){let e=t.$implicit,i=u();n(2),p("value",e.id)("id",e.id)("checked",i.filterCategories[e.id]),w("ngModel",i.filterCategories[e.id]),n(),p("for",e.id),n(),x(e.name)}}var j=class r{value;selectedCategories=new ee;regularValue="regular";irregularValue="irregular";filterCategories=M.reduce((t,e)=>(t[e.id]=!1,t),{});categories={regular:M.filter(t=>!t.includeInBalance),irregular:M.filter(t=>t.includeInBalance)};ngOnChanges(t){t.value&&Array.isArray(this.value)&&(this.initiateFilterCategory(),this.filterCategories=M.reduce((e,i)=>(e[i.id]=this.value.length>0?this.value.includes(i.id):!1,e),{}))}clearCategoryFilters(){this.initiateFilterCategory(),this.emitChanges()}filterCategory(t){let e=t===this.regularValue?this.categories.regular:this.categories.irregular;e=e.map(i=>i.id),this.filterCategories[t]&&e.forEach(i=>{this.filterCategories[i]=!1});for(let i in this.filterCategories)e.includes(i)&&(this.filterCategories[i]=!this.filterCategories[i]);this.emitChanges()}emitChanges(){this.checkMainCategory();let t=this.getSelectedCategories();t=t?.length===M.length?[]:t,this.selectedCategories.emit(t)}checkMainCategory(){let t=this.categories.regular.map(a=>a.id),e=this.categories.irregular.map(a=>a.id),i=t.every(a=>this.filterCategories[a]),o=e.every(a=>this.filterCategories[a]);return this.filterCategories.regular=i,this.filterCategories.irregular=o,{regularChecked:i,irregularChecked:o}}getSelectedCategories(){return Object.keys(this.filterCategories).reduce((t,e)=>(this.filterCategories[e]&&e!==this.regularValue&&e!==this.irregularValue&&t.push(e),t),[])}initiateFilterCategory(){for(let t in this.filterCategories)this.filterCategories[t]=!1;this.filterCategories.irregular=!1,this.filterCategories.regular=!1}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=O({type:r,selectors:[["app-category-filter"]],inputs:{value:"value"},outputs:{selectedCategories:"selectedCategories"},features:[$],decls:19,vars:6,consts:[[1,"category-filter"],[1,"category-filter-clear",3,"click"],[1,"category-filter-checkbox","category-filter-checkbox-main"],["type","checkbox","value","regular","id","category-regular",3,"change","ngModelChange","checked","ngModel"],["for","category-regular"],[1,"category-filter-sub-items"],[4,"ngFor","ngForOf"],["type","checkbox","value","irregular","id","category-irregular",3,"change","ngModelChange","checked","ngModel"],["for","category-irregular"],[1,"category-filter-checkbox","category-filter-checkbox-sub"],["type","checkbox",3,"change","ngModelChange","value","id","checked","ngModel"],[3,"for"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"span"),c(2,"\u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u044F:"),l(),y(3,"br"),s(4,"button",1),g("click",function(){return i.clearCategoryFilters()}),c(5," \u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0432\u0441\u0435 \u0444\u0438\u043B\u044C\u0442\u0440\u044B "),l(),y(6,"br"),s(7,"div",2)(8,"input",3),g("change",function(){return i.filterCategory(i.regularValue)}),k("ngModelChange",function(a){return P(i.filterCategories.regular,a)||(i.filterCategories.regular=a),a}),l(),s(9,"label",4),c(10,"\u0420\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(11,"div",5),h(12,_e,5,6,"ng-container",6),l(),s(13,"div",2)(14,"input",7),g("change",function(){return i.filterCategory(i.irregularValue)}),k("ngModelChange",function(a){return P(i.filterCategories.irregular,a)||(i.filterCategories.irregular=a),a}),l(),s(15,"label",8),c(16,"\u041D\u0435\u0440\u0435\u0433\u0443\u043B\u044F\u0440\u043D\u043E\u0435"),l()(),s(17,"div"),h(18,xe,5,6,"ng-container",6),l()()),e&2&&(n(8),p("checked",i.filterCategories.regular),w("ngModel",i.filterCategories.regular),n(4),p("ngForOf",i.categories.regular),n(2),p("checked",i.filterCategories.irregular),w("ngModel",i.filterCategories.irregular),n(4),p("ngForOf",i.categories.irregular))},dependencies:[B,ae,se,le],styles:[".category-filter[_ngcontent-%COMP%]   .category-filter-clear[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:gray;border:none;background-color:transparent;cursor:pointer;margin:.5rem 0 0;padding:0;text-decoration:underline}.category-filter[_ngcontent-%COMP%]   .category-filter-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:.5rem;margin-top:.5rem}.category-filter[_ngcontent-%COMP%]   .category-filter-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}.category-filter[_ngcontent-%COMP%]   .category-filter-checkbox-main[_ngcontent-%COMP%]{display:flex;font-family:Montserrat,sans-serif;color:#000;flex-direction:row;gap:.5rem}.category-filter[_ngcontent-%COMP%]   .category-filter-checkbox-sub[_ngcontent-%COMP%]{margin-left:2rem}"]})};var be=r=>({"history-expand-filter-button-active":r});function Fe(r,t){if(r&1){let e=_();s(0,"span")(1,"span"),c(2,"\u0424\u0438\u043B\u044C\u0442\u0440\u044B:"),l(),s(3,"i",10),g("click",function(){m(e);let o=u();return f(o.clearFilters())}),l(),y(4,"br"),c(5," \u041F\u0435\u0440\u0438\u043E\u0434: "),s(6,"span"),c(7),l(),y(8,"br"),c(9," \u041A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0438: "),s(10,"span"),c(11),l()()}if(r&2){let e=u();n(),d("font-weight","bold"),n(2),d("padding-left","10px"),n(3),d("color","#ff6f61"),n(),x((e.currentFilter==null?null:e.currentFilter.display)||"\u0412\u0435\u0441\u044C"),n(3),d("color","#ff6f61"),n(),x(e.getCategoryFilters()||"\u0412\u0441\u0435")}}function Se(r,t){if(r&1&&(s(0,"span")(1,"div")(2,"span"),c(3,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),l(),s(4,"span"),c(5),l()()()),r&2){let e=u();n(),d("margin","10","px"),n(3),d("color","#ff6f61"),n(),S("",e.totalAmount,"\u20AC")}}function Me(r,t){if(r&1&&(s(0,"div")(1,"span"),c(2,"\u041E\u0431\u0449\u0438\u0439 \u0440\u0430\u0441\u0445\u043E\u0434: "),l(),s(3,"span"),c(4),l()()),r&2){let e=u();d("margin","10","px"),n(3),d("color","#ff6f61"),n(),S("",e.totalAmount,"\u20AC")}}function Ee(r,t){if(r&1){let e=_();s(0,"div",11)(1,"div",12)(2,"div",13)(3,"app-date-filter",14),g("changeFilter",function(o){m(e);let a=u();return f(a.applyFilters(o))}),l()(),s(4,"app-category-filter",15),g("selectedCategories",function(o){m(e);let a=u();return f(a.applyCategoryFilters(o))}),l()(),s(5,"div",16)(6,"button",17),g("click",function(){m(e);let o=u();return f(o.applyFiltersAndClose())}),c(7,"\u041F\u0440\u0438\u043C\u0435\u043D\u0438\u0442\u044C"),l()()()}if(r&2){let e=u();n(3),p("value",e.currentFilter),n(),p("value",e.predefineCategories)}}function we(r,t){r&1&&(s(0,"div",18)(1,"span"),c(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),l()())}function Pe(r,t){if(r&1&&(s(0,"span")(1,"span"),c(2),I(3,"date"),l(),s(4,"span"),c(5),l()()),r&2){let e=u().$implicit,i=u();d("background","#f8d7da")("width","100%")("display","block"),n(2),S("",T(3,10,e.date,"dd-MM-YYYY")," - "),n(2),d("font-weight","600"),n(),S("",i.getTotalAmountPerDay(e.date),"\u20AC")}}function ke(r,t){if(r&1){let e=_();s(0,"span",17),g("click",function(){m(e);let o=u().index,a=u();return f(a.onDeleteFromBalance(o))}),c(1," | Delete from balance"),l()}r&2&&d("color","grey")("cursor","pointer")}function De(r,t){if(r&1){let e=_();s(0,"span"),h(1,Pe,6,13,"span",19),s(2,"div",20),y(3,"br"),c(4,"\u0426\u0435\u043D\u0430: "),s(5,"span"),c(6),l(),y(7,"br")(8,"br"),s(9,"div"),c(10," Category: "),s(11,"span",21),g("click",function(){let o=m(e).$implicit,a=u();return f(a.filterByCategory(o.category))}),c(12),l()(),c(13),I(14,"date"),I(15,"date"),y(16,"br")(17,"br"),s(18,"span",17),g("click",function(){let o=m(e).index,a=u();return f(a.onDelete(o))}),c(19,"Delete"),l(),h(20,ke,2,4,"span",22),l(),y(21,"hr"),l()}if(r&2){let e=t.$implicit,i=u();n(),p("ngIf",e.showDateTitle),n(4),d("color","#ff6f61"),n(),S("",e.amount,"\u20AC"),n(6),x(i.getCategoryNameByIdFunc(e.category)),n(),te(" Date: ",T(14,16,e.date,"HH:mm")," (",T(15,19,e.date,"dd-MM-YYYY"),")"),n(5),d("color","grey")("cursor","pointer"),n(2),p("ngIf",!e.isDeletedFromBalance&&i.getCategoryByIdFunc(e.category).includeInBalance),n(),d("background","#f8d7da")("height","2px")}}var Y=class r{constructor(t,e,i,o){this.router=t;this.expenseService=e;this.balanceService=i;this.dateFilterService=o}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=z;currentPeriod="\u0437\u0430 \u0441\u0435\u0433\u043E\u0434\u043D\u044F";currentFilter;selectedCategories=[];predefineCategories=[];expandFilters=!1;getCategoryNameByIdFunc=U;destroySubject=new K;ngOnInit(){this.dateFilterService.dateFilter&&(this.currentFilter=L({},this.dateFilterService.dateFilter),this.dateFilterService.dateFilter=void 0);let t=this.dateFilterService.categories;Array.isArray(t)&&t.length>0&&(this.predefineCategories=t,this.selectedCategories=t,this.dateFilterService.categories=void 0),this.currentFilter||t?.length>0?this.applyFilters(this.currentFilter):this.initiateExpenses().pipe(X(),v(this.destroySubject)).subscribe(()=>{this.sumValues()})}initiateExpenses(){return this.expenseService.getExpenses().pipe(Z(t=>{this.expenses=t.map(e=>{let i=this.isDatePanelVisible(e.date);if(i)this.totalAmountPerDays.set(e.date,e.amount);else{let o=this.totalAmountPerDays.get(this.temporaryDate)||0,a=Math.round((o+e.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,a)}return J(L({},e),{showDateTitle:i})})}))}getCategoryFilters(){return this.selectedCategories.map(U).join(", ")}applyFilters(t){this.initiateExpenses().pipe(X(),v(this.destroySubject)).subscribe(()=>{this.selectedCategories.length>0&&(this.expenses=this.expenses.filter(e=>this.selectedCategories.includes(e.category))),this.currentFilter=t,t&&(this.currentPeriod=t.display,this.expenses=me(this.expenses,t.start,t.finish)),this.sumValues()})}applyFiltersAndClose(){this.applyFilters(this.currentFilter),this.expandFilters=!1}filterByCategory(t){this.predefineCategories=[t],this.applyCategoryFilters([t])}applyCategoryFilters(t){this.selectedCategories=t,this.applyFilters(this.currentFilter)}clearFilters(){this.currentFilter=void 0,this.predefineCategories=[],this.selectedCategories=[],this.applyFilters(this.currentFilter)}toggleExpandFilters(){this.expandFilters=!this.expandFilters}getTotalAmountPerDay(t){return this.totalAmountPerDays.get(t)||0}onDelete(t){if(confirm("Delete?")){this.updateBalance(t);let e=this.expenses[t].id;this.expenseService.deleteExpense(e).pipe(Q(()=>this.initiateExpenses()),v(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(t,e){let i=Number(localStorage.getItem("balance"))||0,o=z(this.expenses[t].category);if(i&&!this.expenses[t]?.isDeletedFromBalance&&o?.includeInBalance){let a=Math.round((i+this.expenses[t].amount)*100)/100;this.balanceService.addBalance(a).pipe(v(this.destroySubject)).subscribe()}e&&(this.expenses[t].isDeletedFromBalance=e,this.expenseService.updateExpense(this.expenses[t]).pipe(v(this.destroySubject)).subscribe())}onDeleteFromBalance(t){confirm("Return to balance?")&&this.updateBalance(t,!0)}onSwipeRight(){this.router.navigate(["/"])}showCategoryDetails(t){this.router.navigate(["/details"],{queryParams:{"category-id":t,"back-url":"/history"}})}isDatePanelVisible(t){return this.temporaryDate===0?(this.temporaryDate=t,!0):new Date(this.temporaryDate).toDateString()===new Date(t).toDateString()?!1:(this.temporaryDate=t,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(t){this.touchStartX=t.changedTouches[0].screenX,this.touchStartY=t.changedTouches[0].screenY}onTouchEnd(t){this.touchEndX=t.changedTouches[0].screenX,this.touchEndY=t.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let t=this.touchEndX-this.touchStartX,e=this.touchEndY-this.touchStartY;Math.abs(t)>Math.abs(e)&&(t>50?this.onSwipeRight():t<-50&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((t,e)=>{let i=t+e.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(e){return new(e||r)(E(ue),E(de),E(ge),E(fe))};static \u0275cmp=O({type:r,selectors:[["app-history"]],hostBindings:function(e,i){e&1&&g("touchstart",function(a){return i.onTouchStart(a)})("touchend",function(a){return i.onTouchEnd(a)})},decls:14,vars:18,consts:[[1,"history-container"],[3,"routerLink"],[1,"history-container-top"],[4,"ngIf"],[1,"history-expand-filter-button",3,"click","ngClass"],[1,"fas","fa-filter"],[3,"margin",4,"ngIf"],["class","history-expand-filter-container",4,"ngIf"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"fas","fa-redo-alt",3,"click"],[1,"history-expand-filter-container"],[1,"history-expand-filter"],[1,"history-expand-filter-date"],[3,"changeFilter","value"],[3,"selectedCategories","value"],[1,"history-expand-filter-buttons"],[3,"click"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(e,i){if(e&1&&(s(0,"div",0)(1,"span",1),c(2,"< Back"),l(),y(3,"br"),s(4,"div",2),h(5,Fe,12,10,"span",3)(6,Se,6,5,"span",3),s(7,"button",4),g("click",function(){return i.toggleExpandFilters()}),y(8,"i",5),l()(),h(9,Me,5,5,"div",6)(10,Ee,8,2,"div",7),y(11,"hr"),h(12,we,3,0,"div",8)(13,De,22,22,"span",9),l()),e&2){let o,a,C;n(),d("color","blue")("cursor","pointer"),p("routerLink","/"),n(4),p("ngIf",((i.currentFilter==null?null:i.currentFilter.display)||((o=i.getCategoryFilters())==null?null:o.length))&&!i.expandFilters),n(),p("ngIf",!(i.currentFilter!=null&&i.currentFilter.display)&&!((a=i.getCategoryFilters())!=null&&a.length)||i.expandFilters),n(),p("ngClass",ie(16,be,i.expandFilters)),n(2),p("ngIf",((i.currentFilter==null?null:i.currentFilter.display)||((C=i.getCategoryFilters())==null?null:C.length))&&!i.expandFilters),n(),p("ngIf",i.expandFilters),n(),d("background","#f8d7da")("height","2px"),n(),p("ngIf",!i.expenses.length),n(),p("ngForOf",i.expenses)}},dependencies:[pe,j,re,B,ne,A,oe],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-expand-filter-button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:transparent;border-radius:5px;padding:.5rem 1rem;margin:.5rem;cursor:pointer}.history-expand-filter-button-active[_ngcontent-%COMP%]{background-color:#f8d7da}.history-expand-filter-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;flex-direction:column;margin:.5rem}.history-button-clear-filters[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:gray;border:none;background-color:transparent;cursor:pointer;margin:.5rem 0 0;padding:0;text-decoration:underline}.history-expand-filter-buttons[_ngcontent-%COMP%]{display:flex;margin:1rem 0;width:100%;justify-content:center}.history-expand-filter-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-family:Montserrat,sans-serif;color:#000;border:2px solid #f8d7da;background-color:#f8d7da;border-radius:5px;padding:.5rem 1rem;cursor:pointer;width:100%}.history-expand-filter[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;width:100%}.history-expand-filter[_ngcontent-%COMP%]   .history-expand-filter-date[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;font-family:Montserrat,sans-serif;padding:.5rem;border:2px solid #f8d7da;border-radius:5px;cursor:pointer}.category-checkbox[_ngcontent-%COMP%]{display:flex;align-items:center;flex-direction:row;gap:.5rem;margin-top:.5rem}.category-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{width:100%}.category-checkbox-main[_ngcontent-%COMP%]{display:flex;font-family:Montserrat,sans-serif;color:#000;flex-direction:row;gap:.5rem}.category-checkbox-sub[_ngcontent-%COMP%]{margin-left:2rem}.history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}"]})};var Oe=[{path:"",component:Y}],R=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=F({type:r});static \u0275inj=b({imports:[D.forChild(Oe),D]})};var W=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=F({type:r});static \u0275inj=b({imports:[V,H]})};var ye=class r{static \u0275fac=function(e){return new(e||r)};static \u0275mod=F({type:r});static \u0275inj=b({imports:[D,W,R,V,H,ce,A]})};export{ye as HistoryModule};
