import{$ as w,Aa as z,Ba as U,Ca as S,D as r,Da as k,E as b,Ea as O,F as v,G as u,H as m,Ha as J,Ia as K,J as s,K as a,Ka as Q,L as f,La as W,M as T,Ma as I,N as d,O as p,Q as l,R as B,S as E,T as N,Z as M,a as j,ea as R,fa as X,i as F,ia as L,j as A,ja as $,k as y,l as V,n as C,q as Y,r as D,v as _,w as x,wa as G,xa as q}from"./chunk-5U2HUSPZ.js";import{a as h,b as g}from"./chunk-MZBEQE75.js";function te(n,e){n&1&&(s(0,"div",5)(1,"span"),l(2,"\u0414\u043B\u044F \u044D\u0442\u0438\u0445 \u043A\u0430\u0442\u0435\u0433\u043E\u0440\u0438\u0439 \u0438 \u043F\u0435\u0440\u0438\u043E\u0434\u0430 \u0442\u0440\u0430\u0442 \u043D\u0435\u0442"),a()())}function ie(n,e){if(n&1&&(s(0,"span")(1,"span"),l(2),M(3,"date"),a(),s(4,"span"),l(5),a()()),n&2){let t=p().$implicit,i=p();m("background","#f8d7da")("width","100%")("display","block"),r(2),E("",w(3,10,t.date,"dd-MM-YYYY")," - "),r(2),m("font-weight","600"),r(),E("",i.getTotalAmountPerDay(t.date),"\u20AC")}}function ne(n,e){n&1&&(s(0,"span"),l(1,'"'),a())}function re(n,e){n&1&&(s(0,"span"),l(1,'"'),a())}function oe(n,e){if(n&1){let t=T();s(0,"span",13),d("click",function(){_(t);let c=p().index,o=p();return x(o.onDeleteFromBalance(c))}),l(1," | Delete from balance"),a()}n&2&&m("color","grey")("cursor","pointer")}function se(n,e){if(n&1){let t=T();s(0,"span"),v(1,ie,6,13,"span",6),s(2,"div",7),f(3,"br"),l(4,"\u0426\u0435\u043D\u0430: "),s(5,"span"),l(6),a(),f(7,"br")(8,"br"),s(9,"div"),l(10," Category: "),s(11,"span",8),d("click",function(){let c=_(t).$implicit,o=p();return x(o.filterByCategory(c.category))}),l(12),a(),s(13,"i",9),d("click",function(){let c=_(t).$implicit,o=p();return x(o.navigateToChart(c.category))}),a()(),l(14),M(15,"date"),M(16,"date"),s(17,"div")(18,"span",10),l(19,"Description:"),a(),v(20,ne,2,0,"span",11),s(21,"span"),l(22),a(),v(23,re,2,0,"span",11),s(24,"i",12),d("click",function(){let c=_(t).$implicit,o=p();return x(o.changeDescription(c))}),a()(),f(25,"br")(26,"br"),s(27,"span",13),d("click",function(){let c=_(t).index,o=p();return x(o.onDelete(c))}),l(28,"Delete"),a(),v(29,oe,2,4,"span",14),a(),f(30,"hr"),a()}if(n&2){let t=e.$implicit,i=p();r(),u("ngIf",t.showDateTitle),r(4),m("color","#ff6f61"),r(),E("",t.amount,"\u20AC"),r(6),B(i.getCategoryNameByIdFunc(t.category)),r(2),N(" Date: ",w(15,19,t.date,"HH:mm")," (",w(16,22,t.date,"dd-MM-YYYY"),") "),r(6),u("ngIf",t.description),r(2),B(t.description),r(),u("ngIf",t.description),r(4),m("color","grey")("cursor","pointer"),r(2),u("ngIf",!t.isDeletedFromBalance&&i.getCategoryByIdFunc(t.category).includeInBalance),r(),m("background","#f8d7da")("height","2px")}}var P=class n{constructor(e,t,i,c){this.router=e;this.expenseService=t;this.balanceService=i;this.dateFilterService=c}expenses=[];totalAmount=0;temporaryDate=0;totalAmountPerDays=new Map;getCategoryByIdFunc=O;defaultFilter={categories:[],date:void 0};currentFilter={categories:[],date:void 0};getCategoryNameByIdFunc=k;destroySubject=new j;ngOnInit(){this.dateFilterService.dateFilter&&(this.defaultFilter=g(h({},this.defaultFilter),{date:this.dateFilterService.dateFilter}),this.dateFilterService.dateFilter=void 0);let e=this.dateFilterService.categories;Array.isArray(e)&&e.length>0&&(this.defaultFilter=g(h({},this.defaultFilter),{categories:e}),this.dateFilterService.categories=void 0),this.defaultFilter?.date||this.defaultFilter?.categories?.length>0?this.applyFilters(this.defaultFilter):this.initiateExpenses().pipe(F(),y(this.destroySubject)).subscribe(()=>{this.sumValues()})}initiateExpenses(){return this.expenseService.getExpenses().pipe(V(e=>{this.expenses=e.map(t=>{let i=this.isDatePanelVisible(t.date);if(i)this.totalAmountPerDays.set(t.date,t.amount);else{let c=this.totalAmountPerDays.get(this.temporaryDate)||0,o=Math.round((c+t.amount)*100)/100;this.totalAmountPerDays.set(this.temporaryDate,o)}return g(h({},t),{showDateTitle:i})})}))}changeDescription(e){let t=prompt("Change description",e?.description);if(t!==null){let i=e.description?e.description:"";t=t?t.replace(/\s/g,""):"",i!==t&&this.expenseService.updateExpense(g(h({},e),{description:t})).pipe(F(),y(this.destroySubject)).subscribe(()=>{this.applyFilters(this.currentFilter)})}}navigateToChart(e){this.dateFilterService.categories=[e],this.dateFilterService.dateFilter=this.currentFilter?.date,this.router.navigate(["/details"],{queryParams:{"back-url":"/history"}})}getCategoryFilters(){return this.defaultFilter?.categories.map(k).join(", ")}applyFilters(e){this.currentFilter=h({},e||{categories:[],date:void 0}),this.initiateExpenses().pipe(F(),y(this.destroySubject)).subscribe(()=>{e?.categories.length>0&&(this.expenses=this.expenses.filter(t=>e?.categories.includes(t.category))),e?.date&&(this.expenses=Q(this.expenses,e?.date?.start,e?.date?.finish)),this.sumValues()})}filterByCategory(e){this.defaultFilter=g(h({},this.currentFilter),{categories:[e]}),this.applyFilters(this.defaultFilter),window.scrollTo({top:0,behavior:"smooth"})}getTotalAmountPerDay(e){return this.totalAmountPerDays.get(e)||0}onDelete(e){if(confirm("Delete?")){this.updateBalance(e);let t=this.expenses[e].id;this.expenseService.deleteExpense(t).pipe(A(()=>this.initiateExpenses()),y(this.destroySubject)).subscribe(()=>this.sumValues())}}updateBalance(e,t){let i=Number(localStorage.getItem("balance"))||0,c=O(this.expenses[e].category);if(i&&!this.expenses[e]?.isDeletedFromBalance&&c?.includeInBalance){let o=Math.round((i+this.expenses[e].amount)*100)/100;this.balanceService.addBalance(o).pipe(y(this.destroySubject)).subscribe()}t&&(this.expenses[e].isDeletedFromBalance=t,this.expenseService.updateExpense(this.expenses[e]).pipe(y(this.destroySubject)).subscribe())}onDeleteFromBalance(e){confirm("Return to balance?")&&this.updateBalance(e,!0)}onSwipeRight(){this.router.navigate(["/"])}isDatePanelVisible(e){return this.temporaryDate===0?(this.temporaryDate=e,!0):new Date(this.temporaryDate).toDateString()===new Date(e).toDateString()?!1:(this.temporaryDate=e,!0)}touchStartX=0;touchStartY=0;touchEndX=0;touchEndY=0;onTouchStart(e){this.touchStartX=e.changedTouches[0].screenX,this.touchStartY=e.changedTouches[0].screenY}onTouchEnd(e){this.touchEndX=e.changedTouches[0].screenX,this.touchEndY=e.changedTouches[0].screenY,this.handleSwipeGesture()}handleSwipeGesture(){let e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;Math.abs(e)>Math.abs(t)&&(e>100?this.onSwipeRight():e<-100&&this.onSwipeLeft())}onSwipeLeft(){this.router.navigate(["/statistics"])}ngOnDestroy(){this.destroySubject.next(),this.destroySubject.complete()}sumValues(){this.totalAmount=this.expenses.reduce((e,t)=>{let i=e+t.amount;return Math.round(i*100)/100},0)}static \u0275fac=function(t){return new(t||n)(b(z),b(J),b(K),b(W))};static \u0275cmp=Y({type:n,selectors:[["app-history"]],hostBindings:function(t,i){t&1&&d("touchstart",function(o){return i.onTouchStart(o)})("touchend",function(o){return i.onTouchEnd(o)})},decls:8,vars:13,consts:[[1,"history-container"],[3,"routerLink"],[3,"selectedFilters","value","totalAmount"],["class","history-empty",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"history-empty"],[3,"background","width","display",4,"ngIf"],[1,"history-item"],[1,"app-link",3,"click"],[1,"fas","fa-chart-bar","history-item-chart",3,"click"],[1,"history-item-description-label"],[4,"ngIf"],[1,"history-item-description-edit-icon","fas","fa-pencil-alt",3,"click"],[3,"click"],[3,"color","cursor","click",4,"ngIf"]],template:function(t,i){t&1&&(s(0,"div",0)(1,"span",1),l(2,"< Back"),a(),f(3,"br"),s(4,"app-multi-filter",2),d("selectedFilters",function(o){return i.applyFilters(o)}),a(),f(5,"hr"),v(6,te,3,0,"div",3)(7,se,31,25,"span",4),a()),t&2&&(r(),m("color","blue")("cursor","pointer"),u("routerLink","/"),r(3),u("value",i.defaultFilter)("totalAmount",i.totalAmount),r(),m("background","#f8d7da")("height","2px"),r(),u("ngIf",!i.expenses.length),r(),u("ngForOf",i.expenses))},dependencies:[U,R,X,I,L],styles:[".history-container[_ngcontent-%COMP%]{height:100dvh;overflow-y:scroll}.history-container[_ngcontent-%COMP%]   .history-item[_ngcontent-%COMP%]{padding-left:10px}.history-container[_ngcontent-%COMP%]   .history-container-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:0 1rem 0 0}.history-container[_ngcontent-%COMP%]   .history-empty[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;font-family:Montserrat,sans-serif;color:#000}.history-container[_ngcontent-%COMP%]   .history-item-chart[_ngcontent-%COMP%]{padding:15px 15px 0 25px;font-size:15px;color:gray}.history-container[_ngcontent-%COMP%]   .history-item-description-label[_ngcontent-%COMP%]{margin-right:5px}.history-container[_ngcontent-%COMP%]   .history-item-description-edit-icon[_ngcontent-%COMP%]{padding:5px;color:gray;cursor:pointer}"]})};var ae=[{path:"",component:P}],H=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=D({type:n});static \u0275inj=C({imports:[S.forChild(ae),S]})};var ee=class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=D({type:n});static \u0275inj=C({imports:[S,H,$,G,q,I]})};export{ee as HistoryModule};
